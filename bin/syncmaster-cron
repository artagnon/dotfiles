#! /bin/bash

set -e

# LOGNAME=rramacha # set in environment
NOBUILD=/hub/share/sbtools/etc/sbsync/cfg/cgir_syncmaster.cfg
DEBUG=/hub/share/sbtools/etc/sbsync/cfg/cgir_syncmaster_debug.cfg
LOGDIR=/tmp/$LOGNAME/syncmaster
WORKDIR=/local-ssd/$LOGNAME

if [ ! -d $LOGDIR ]; then
    mkdir -p $LOGDIR
fi

# sbsyncmaster -C $WORKDIR -log-dir $LOGDIR/bdacore_integ -src-root bdacore_integ -cfg $DEBUG
# sbsyncmaster -C $WORKDIR -log-dir $LOGDIR/bcg_integ -src-root bcg_integ -cfg $NOBUILD
# sbsyncmaster -C $WORKDIR -log-dir $LOGDIR/bcg_integ -src-root bcg_integ -cfg $DEBUG -prime-from $WORKDIR/bdacore_integ.lp

BCGIR_TASK_PRIME_FROM=""
# If we already have bcgir_task.lp, prime from it
if [ -d bcgir_task.lp ]; then
    BCGIR_TASK_PRIME_FROM="-prime-from bcgir_task.lp"
fi
sbsyncmaster -C $WORKDIR -create bcgir_task.lp -log-dir $LOGDIR/bcgir_task -src-root bcgir_task -cfg $DEBUG $BCGIR_TASK_PRIME_FROM
sbsyncmaster -C $WORKDIR -create bcgir_thin.lp -log-dir $LOGDIR/bcgir_task -src-root bcgir_thin -cfg $DEBUG $BCGIR_TASK_PRIME_FROM
sbsyncmaster -C $WORKDIR -create bmatlabcoder.lp -log-dir $LOGDIR/bmatlabcoder -src-root bmatlabcoder -cfg $DEBUG $BCGIR_TASK_PRIME_FROM
